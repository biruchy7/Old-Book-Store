<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Conversations - Old Book Store</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/message.css') }}" />
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" />
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

</head>
<body>

<!-- Navigation -->
<section id="header">
  <div id="logo">
    <a href="{{ url_for('home') }}">
      <img src="{{ url_for('static', filename='img/logo.png') }}" alt="OldBookStore.com" />
    </a>
  </div>
  <div>
    <ul id="navbar">
      <li><a href="{{ url_for('home') }}">Home</a></li>
      <li><a href="{{ url_for('buy') }}">Buy</a></li>
      <li><a href="{{ url_for('sell') }}">Sell</a></li><li>
        <a href="{{ url_for('orders') }}">Orders</a></li>
      <li><a href="{{ url_for('wishlist') }}">Wishlist</a></li>

      {% if session.get('user_id') %}
        {% if session.get('role') == 'admin' %}
          <li><a href="{{ url_for('admin') }}">Admin</a></li>
        {% endif %}
        <li><a href="{{ url_for('logout') }}">Logout</a></li>
      {% else %}
        <li><a href="{{ url_for('login') }}">Login/Register</a></li>
      {% endif %}
    </ul>
  </div>
</section>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div id="flashes" style="max-width:700px; margin:20px auto;">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Page Heading -->
<h2>Your Conversations</h2>

<nav style="max-width:700px; margin: 0 auto 30px auto;">
  <a href="{{ url_for('home') }}">‚Üê Back to Home</a>
</nav>

<!-- Conversation List -->
{% if conversations %}
  <ul class="conversation-list" role="list" aria-label="User Conversations" >
    {% for convo in conversations %}
      <li>
        <a href="{{ url_for('message_user_book', receiver_id=convo.user_id, book_id=convo.book_id) }}">
          <span>{{ convo.username }}</span>
          {% if convo.unread_count > 0 %}
            <span class="unread-count" aria-label="{{ convo.unread_count }} unread messages">
              {{ convo.unread_count }}
            </span>
          {% endif %}
        </a>
        <div class="last-message" title="{{ convo.last_message }}">
          {{ convo.last_message | e }}
        </div>
        <div class="last-message-meta">
          {% if convo.last_message_time %}
            {{ convo.last_message_time.strftime('%Y-%m-%d %H:%M') }}
          {% endif %}
        </div>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p style="text-align:center; color:#555; max-width:700px; margin: 0 auto;">You have no conversations yet.</p>
{% endif %}

<!-- Footer -->
<footer class="section-p1">
  <div class="col">
    <img class="logo" src="{{ url_for('static', filename='img/logo.png') }}" alt="OldBookStore Logo"/>
    <h4>Contact</h4>
    <p><strong>Address:</strong> Dhangadhi, Kailali</p>
    <p><strong>Phone:</strong> +977 9848562356 / +977 9848757575</p>
    <p><strong>Hours:</strong> 10:00 - 18:00, Mon - Sat</p>
  </div>
</footer>

<div class="Copyrignt">
  Copyright &copy; www.OldBookStore.com All rights reserved.
</div>

</body>
</html>
